<html>
<head> <script src="../jquery-1.11.2.min.js"></script>
<script src="../wave.js"></script>
<!-- Highlight JS -->
<!--link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/monokai.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script-->

<script>
//hljs.initHighlightingOnLoad();
$(document).ready(function() {
    var NUM_SAMPLES = 100;
    var canvas = document.getElementById('buttbutt-canvas');
    var context = canvas.getContext('2d');
    var width = canvas.width;
    var height = canvas.height;
    var r = Math.min(width, height) / 3;

    var w = wave({
        numSamples: NUM_SAMPLES,
        wrap: true
    });

    $(canvas).click(function(evt) {
        var x, y;
        x = evt.offsetX - width/2;
        y = -evt.offsetY + height/2;

        var theta = Math.atan2(y, x);
        var splashX;
        if (theta > 0) {
            splashX = 1 - 0.5 * theta / Math.PI;
        } else {
            splashX = -0.5 * theta / Math.PI;
        }

        var strength = 0.2;
        if (context.isPointInPath(evt.offsetX, evt.offsetY)) {
            // do something
        }
        w.splash(splashX, 1, strength);
        w.churn(splashX, 1, strength);
    });

    requestAnimationFrame(frame);

    function frame() {
        for (var i = 0; i < 10; i++) {
            w.tick(0.1);
        }
        renderWave();
        requestAnimationFrame(frame);
    }

    function renderWave() {
        context.clearRect(0, 0, width, height);
        context.lineWidth = 2;

        var unitTheta = Math.PI * 2 / NUM_SAMPLES;
        context.translate(width/2, height/2);

        context.beginPath();
        context.moveTo(r + w.height(0) * r, 0);

        for (var i = 1; i < NUM_SAMPLES; i++) {
            context.rotate(unitTheta);
            context.lineTo(r + w.height(i) * r, 0);
        }

        context.closePath();

        var gradient = context.createRadialGradient(0, 0, 0, 0, 0, r*2);
        gradient.addColorStop(0, 'rgba(200, 90, 50, 0.1)');
        gradient.addColorStop(1, 'rgba(200, 90, 50, 0.5)');
        context.fillStyle = gradient;
        context.fill();
        context.stroke();

        /*
        // Draw the smile
        context.setTransform(1, 0, 0, 1, 0, 0);
        context.translate(width/2, height/2);

        context.moveTo(r/2 + w.height(0) * r/2, 0);
        for (var i = 1; i < NUM_SAMPLES; i++) {
            context.rotate(unitTheta);
            context.lineTo(r/2 + w.height(i) * r/2, 0);
        }
        context.stroke();

        // Draw the eyes
        context.beginPath();
        context.rotate(unitTheta * NUM_SAMPLES * 0.25);
        context.arc(r/2 * w.height(Math.floor(NUM_SAMPLES * 0.75)) + r/2, 0, 5, 0, Math.PI * 2, false);
        context.fillStyle = 'black';
        context.fill();

        context.rotate(unitTheta * NUM_SAMPLES * 0.5);
        context.arc(r/2 * w.height(Math.floor(NUM_SAMPLES * 0.25)) + r/2, 0, 5, 0, Math.PI * 2, false);
        context.fillStyle = 'black';
        context.fill();
        */

        // Set the current transformation on the context back to
        // what we started with
        context.setTransform(1, 0, 0, 1, 0, 0);
    }
});
</script>
<style>
body {
    text-align: center;
    font-family: Helvetica Neue, sans-serif;
}

h1 {
    font-size: 64px;
    font-weight: 200;
    margin: 0;
}

canvas {
    cursor: pointer;
}

code {
    width: 800px;
    margin: 20px auto;
    text-align: left;
    font-family: Andale Mono, sans-serif;
}
</style>
</head>
<body>
<h1>Wobble the Bubble</h1>
<canvas id="buttbutt-canvas" width="500px" height="500px"></canvas>
<body>
</html>
